----------------------------- X GISA

alter table access_dati
add column qualifica text default 'N.D.',
add column profilo_professionale text default 'N.D.';

CREATE OR REPLACE VIEW public.lista_utenti_centralizzata
 AS
 SELECT a.in_dpat,
    a.in_access,
    a.in_nucleo_ispettivo,
    a.username,
    a.password,
    a.role_id,
    a.last_login,
    a.manager_id,
    ad.site_id AS siteid,
    a.last_ip,
    a.timezone,
    a.startofday AS access_startofday,
    a.endofday AS access_endofday,
    a.expires,
    a.alias,
    a.contact_id AS contact_id_link,
    a.user_id AS access_user_id,
    r.carico_default AS carico_lavoro_annuale,
    a.enabled AS access_enabled,
    a.assistant AS access_assistant,
    a.entered AS access_entered,
    a.enteredby AS access_enteredby,
    a.modified AS access_modified,
    a.modifiedby AS access_modifiedby,
    a.currency,
    a.language,
    a.webdav_password,
    a.hidden,
    a.allow_webdav_access,
    a.allow_httpapi_access,
    a.data_scadenza,
    r.role AS systemrole,
    r.role_type,
    m_usr.enabled AS mgr_enabled,
    b.description AS site_id_name,
    c.contact_id,
    c.user_id,
    c.org_id,
    c.company,
    c.title,
    c.department,
    c.super,
    c.namesalutation,
    c.namelast,
    c.namefirst,
    c.namemiddle,
    c.namesuffix,
    c.assistant,
    c.birthdate,
    c.notes,
    c.site,
    c.locale,
    c.employee_id,
    c.employmenttype,
    c.startofday,
    c.endofday,
    c.entered,
    c.enteredby,
    c.modified,
    c.modifiedby,
    c.enabled,
    c.owner,
    c.custom1,
    c.url,
    c.primary_contact,
    c.employee,
    c.org_name,
    c.access_type,
    c.status_id,
    c.import_id,
    c.information_update_date,
    c.lead,
    c.lead_status,
    c.source,
    c.rating,
    c.comments,
    c.conversion_date,
    c.additional_names,
    c.nickname,
    c.role,
    c.trashed_date,
    c.secret_word,
    c.account_number,
    c.revenue,
    c.industry_temp_code,
    c.potential,
    c.no_email,
    c.no_mail,
    c.no_phone,
    c.no_textmessage,
    c.no_im,
    c.no_fax,
    ad.site_id,
    c.assigned_date,
    c.lead_trashed_date,
    c.employees,
    c.duns_type,
    c.duns_number,
    c.business_name_two,
    c.sic_code,
    c.year_started,
    c.sic_description,
    c.site_id_old,
    c.codice_fiscale,
    c.luogo,
    true AS orgenabled,
    'n.d'::text AS departmentname,
    ''::text AS city,
    ''::text AS postalcode,
    'n.d'::text AS industry_name,
    'n.d'::text AS source_name,
    'n.d'::text AS stage_name,
    'n.d'::text AS rating_name,
    'n.d'::text AS import_name,
    ''::text AS state,
    r.super_ruolo,
    r.descrizione_super_ruolo,
    ad.visibilita_delega,
    a.pec_suap,
    a.callback_suap,
    ''::text AS istat_comune,
    ad.num_registrazione_stab,
    a.callback_suap_ko,
    r.enabled_as_qualifica,
    ad.qualifica,
    ad.profilo_professionale
   FROM access a
     LEFT JOIN contact_ c ON a.contact_id = c.contact_id
     LEFT JOIN access_ m_usr ON a.manager_id = m_usr.user_id
     LEFT JOIN role r ON a.role_id = r.role_id
     LEFT JOIN access_dati ad ON ad.user_id = a.user_id
     LEFT JOIN lookup_site_id b ON ad.site_id = b.code
  WHERE a.user_id > '-1'::integer AND a.trashed_date IS NULL
UNION
 SELECT a.in_dpat,
    a.in_access,
    a.in_nucleo_ispettivo,
    a.username,
    a.password,
    a.role_id,
    a.last_login,
    a.manager_id,
    ad.site_id AS siteid,
    a.last_ip,
    a.timezone,
    a.startofday AS access_startofday,
    a.endofday AS access_endofday,
    a.expires,
    a.alias,
    a.contact_id AS contact_id_link,
    a.user_id AS access_user_id,
    r.carico_default AS carico_lavoro_annuale,
    a.enabled AS access_enabled,
    a.assistant AS access_assistant,
    a.entered AS access_entered,
    a.enteredby AS access_enteredby,
    a.modified AS access_modified,
    a.modifiedby AS access_modifiedby,
    a.currency,
    a.language,
    a.webdav_password,
    a.hidden,
    a.allow_webdav_access,
    a.allow_httpapi_access,
    a.data_scadenza,
    r.role AS systemrole,
    r.role_type,
    m_usr.enabled AS mgr_enabled,
    b.description AS site_id_name,
    c.contact_id,
    c.user_id,
    c.org_id,
    c.company,
    c.title,
    c.department,
    c.super,
    c.namesalutation,
    c.namelast,
    c.namefirst,
    c.namemiddle,
    c.namesuffix,
    c.assistant,
    c.birthdate,
    c.notes,
    c.site,
    c.locale,
    c.employee_id,
    c.employmenttype,
    c.startofday,
    c.endofday,
    c.entered,
    c.enteredby,
    c.modified,
    c.modifiedby,
    c.enabled,
    c.owner,
    c.custom1,
    c.url,
    c.primary_contact,
    c.employee,
    c.org_name,
    c.access_type,
    c.status_id,
    c.import_id,
    c.information_update_date,
    c.lead,
    c.lead_status,
    c.source,
    c.rating,
    c.comments,
    c.conversion_date,
    c.additional_names,
    c.nickname,
    c.role,
    c.trashed_date,
    c.secret_word,
    c.account_number,
    c.revenue,
    c.industry_temp_code,
    c.potential,
    c.no_email,
    c.no_mail,
    c.no_phone,
    c.no_textmessage,
    c.no_im,
    c.no_fax,
    ad.site_id,
    c.assigned_date,
    c.lead_trashed_date,
    c.employees,
    c.duns_type,
    c.duns_number,
    c.business_name_two,
    c.sic_code,
    c.year_started,
    c.sic_description,
    c.site_id_old,
    c.codice_fiscale,
    c.luogo,
    true AS orgenabled,
    'n.d'::text AS departmentname,
    ''::text AS city,
    ''::text AS postalcode,
    'n.d'::text AS industry_name,
    'n.d'::text AS source_name,
    'n.d'::text AS stage_name,
    'n.d'::text AS rating_name,
    'n.d'::text AS import_name,
    ''::text AS state,
    r.super_ruolo,
    r.descrizione_super_ruolo,
    ad.visibilita_delega,
    a.pec_suap,
    a.callback_suap,
    a.istat_comune,
    ad.num_registrazione_stab,
    a.callback_suap_ko,
    r.enabled_as_qualifica,
    ad.qualifica,
    ad.profilo_professionale
   FROM access_ext a
     LEFT JOIN contact_ext_ c ON a.contact_id = c.contact_id
     LEFT JOIN access_ext_ m_usr ON a.manager_id = m_usr.user_id
     LEFT JOIN role_ext r ON a.role_id = r.role_id
     LEFT JOIN access_dati ad ON ad.user_id = a.user_id
     LEFT JOIN lookup_site_id b ON ad.site_id = b.code
  WHERE a.user_id > '-1'::integer AND a.trashed_date IS NULL;
