create table mapping_osm_ml8 (linea_osm text, codice_univoco_ml8 text);

insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('01 - Coltivazione prodotti destinabili all''alimentazione zootecnica','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('04 - Stoccaggio prodotti primari sul luogo di produzione','MG-OPRA-M01');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('12 - Produzione premiscele (diversi da all. IV, capo 2)','MG-DG-M09');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('16 - Commercio ingrosso/dettaglio additivi e premiscele (diverse da all. IV capo 1 e 2)','MG-DG-M16');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('08 - Allevatori che effettuano miscelazione senza additivi e premiscele','MG-OPRZ-M02');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('07 - Trasportatori conto terzi di materie prime - mangimi composti','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('15 - Condizionamento additivi, premiscele e mangimi (diverse da allegato IV)','MG-DG-M13');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('10 - Impianti di stoccaggio','MG-DG-M12');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('11 - Produzione additivi (diversi da all. IV, capo 1)','MG-DG-M08');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('02 - Essiccazione granaglie conto proprio','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('13 - Produzione mangimi commercio (diversi da all. IV, capo 3)','MG-DG-M10');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('05 - Macinazione e brillatura (mulini)','MG-DG-M39');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('03 - Essiccazione conto terzi','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('14 - Produzione di alimenti per animali da compagnia ai sensi dell''art. 17 del Reg. 1774/02','MG-DG-M07');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('17 - Trasportatori di premiscele ed additivi','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('06 - Commercio all''ingrosso ed al dettaglio di prodotti agricoli e zootecnici, Mangimi, prodotti di origine minerale e chimico industriali, etc.','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('18 - Altro','MG');
insert into mapping_osm_ml8 (linea_osm, codice_univoco_ml8) values ('N.D.','MG');


alter table mapping_osm_ml8 add column map_completo boolean default true;
update mapping_osm_ml8 set map_completo = false where codice_univoco_ml8 = 'MG'



update scheda_operatore_metadati set enabled = false where tipo_operatore = 5;insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','ELENCO DIFFIDE','capitolo','','','','i','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','DETTAGLI ADDIZIONALI','capitolo','','','','gab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','INDIRIZZI','capitolo','','','','fab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','PARTITA IVA','','partita_iva ','organization ','org_id = #orgid#','bab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','CODICE FISCALE   ','','codice_fiscale as codice_fiscale_impresa','organization ','org_id = #orgid#','bac','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','STATO OSM','','coalesce ( lsl.description, '' '' )  || '' '' || 
''in data '' || case when o.date2 is not null then to_char ( o.date2, ''dd/mm/yyyy'')  else '' '' end ','organization o left join lookup_stato_lab lsl on (o.stato_lab = lsl.code) ','o.org_id = #orgid# ','BAD','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','CATEGORIA DI RISCHIO','','case when categoria_rischio is null then (''3'') else categoria_rischio end
','organization ','org_id = #orgid#','c','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','INFORMAZIONE PRIMARIA','capitolo','','','','a','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','ASL','asl','asl.description as descr_asl ','lookup_site_id asl left join organization o on o.site_id = asl.code ','o.org_id = #orgid#','ab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','IMPRESA','','name as ragione_sociale ','organization ','org_id = #orgid#','abc','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','NUMERO REGISTRAZIONE','barcode','case when account_number is null or account_number='''' then ''non definito'' else 
case when tipologia = 800 then ''ait''|| account_number else account_number end end as numero_registrazione ','organization ','org_id = #orgid#','b','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','ATTIVITA''','','description ','elenco_attivita_osm_reg e left join lookup_attivita_osm_reg l on (e.id_attivita = l.code) ','org_id = #orgid#','ba','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','PRINCIPALI TIPOLOGIE PRODUTTIVE','','distinct (coalesce ( e.descrizione_attivita , '' '' ) ) || '' ''','elenco_attivita_osm_reg e left join lookup_attivita_osm_reg l on (e.id_attivita = l.code)','org_id = #orgid#','ba0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','PROSSIMO CONTROLLO CON LA TECNICA DELLA SORVEGLIANZA','','case when prossimo_controllo is null then to_char(current_timestamp, ''dd/mm/yyyy'') else to_char(prossimo_controllo, ''dd/mm/yyyy'') end  as prossimo_controllo ','organization ','org_id = #orgid#','ca','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','DATA INIZIO ATTIVITA''','','to_char(date2, ''dd/mm/yyyy'') as data_inizio ','organization ','org_id = #orgid#','cab0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','DATA FINE ATTIVITA''','','to_char(date1, ''dd/mm/yyyy'') as data_fine ','organization ','org_id = #orgid#','CAB1','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','TITOLARE O LEGALE RAPPRESENTANTE','capitolo','','','','d','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','CODICE FISCALE TITOLARE','','codice_fiscale_rappresentante as codice_fiscale_titolare ','organization ','org_id = #orgid#','d0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','NOME TITOLARE','','nome_rappresentante as nome_titolare ','organization ','org_id = #orgid#','da','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','COGNOME TITOLARE','','cognome_rappresentante as cognome_titolare ','organization ','org_id = #orgid#','dab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','DATA DI NASCITA TITOLARE','','to_char(data_nascita_rappresentante, ''dd/mm/yyyy'') as data_nascita_titolare ','organization ','org_id = #orgid#','e','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','LUOGO DI NASCITA TITOLARE','','luogo_nascita_rappresentante as luogo_nascita_titolare ','organization ','org_id = #orgid#','ea','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','TELEFONO TITOLARE','','telefono_rappresentante as telefono_titolare ','organization ','org_id = #orgid#','eab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','FAX TITOLARE','','fax as fax_titolare ','organization ','org_id = #orgid#','f','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','EMAIL TITOLARE','','email_rappresentante as email_titolare ','organization ','org_id = #orgid#','fa','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','SEDE LEGALE','capitolo','','','','fab0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','SEDE LEGALE','indirizzo','case when upper(oaleg.addrline1) is not null then upper(oaleg.addrline1) else  '' '' end || ''  ''|| case when upper(oaleg.addrline2) is not null  then upper(oaleg.addrline2) else  '' '' end || ''  ''|| case  when upper(oaleg.city) is not null  then upper(oaleg.city) else  '' '' end || ''  ''||  case when oaleg.postalcode is not null  then oaleg.postalcode else  '' '' end || ''  ''|| case  when upper(oaleg.state) is not null  then upper(oaleg.state) else  '' ''  end as ind_sede_legale ','organization o left join organization_address oaleg on (o.org_id = oaleg.org_id and oaleg.address_type = 1) ','o.org_id = #orgid#','g','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','SEDE OPERATIVA','capitolo','','','','g0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','SEDE OPERATIVA','indirizzo','case when upper(oaope.addrline1) is not null then upper(oaope.addrline1) else  '' '' end || ''  ''|| case when upper(oaope.city) is not null  then upper(oaope.city) else  '' '' end || '' ''|| case when oaope.postalcode is not null  then oaope.postalcode else  '' '' end || ''  ''|| case when oaope.state is not null  then oaope.state else  '' '' end as ind_sede_operativa ','organization o left join organization_address oaope on (o.org_id = oaope.org_id and oaope.address_type = 5) ','o.org_id = #orgid#','ga','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','NOTE','','notes ','organization ','org_id = #orgid#','h','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','DIFFIDATO PER ','',' 	lookup_norme.description || '', ''|| CASE WHEN diffida.stato_diffida = ''0'' then ''[DIFFIDA ATTIVA PER I PROSSIMI 5 ANNI]'' WHEN diffida.stato_diffida = ''1'' then '' [DIFFIDA NON PIU'''' ATTIVA IN QUANTO L''''OSA E'''' STATO SANZIONATO PER QUESTA NORMA]'' end ||'', ''|| ''data diffida: ''|| to_char(t.assigned_date,''dd/mm/yyyy'') as assigned_date','ticket t JOIN ticket nonconf ON nonconf.ticketid = t.id_nonconformita AND nonconf.tipologia = 8 JOIN ticket cu ON cu.id_controllo_ufficiale::text = nonconf.id_controllo_ufficiale::text AND cu.tipologia = 3 left join norme_violate_sanzioni diffida on diffida.idticket=t.ticketid left join lookup_norme on lookup_norme.code=diffida.id_norma','t.ticketid > 0 AND t.tipologia = 11 and current_timestamp< (cu.assigned_date + interval ''5 years'') and t.trashed_date is null and cu.trashed_date is null and nonconf.trashed_date is null and t.org_id = #orgid# order by assigned_date DESC ','l','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','LISTA LINEE PRODUTTIVE','capitolo','','','','GAA','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('5','ATTIVITA','','norma ||''<br/>''|| macroarea ||''<br/>''|| aggregazione ||''<br/>''||attivita','ricerche_anagrafiche_old_materializzata','riferimento_id = #orgid# and riferimento_id_nome_col = ''org_id''','GAAA','');

update scheda_operatore_metadati set enabled = false where tipo_operatore = 17;insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','INDIRIZZI','capitolo','','','','fab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','ELENCO DIFFIDE','capitolo','','','','i','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','ATTIVITA''','','case when impianto > -1 then description else taxid end ','organization o left join lookup_attivita_osm l on (o.impianto = l.code) ','org_id = #orgid#','ba','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DECRETO','','coalesce ( lead , '' '' ) || '' ''','organization','org_id = #orgid#','BA0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','PRINCIPALI TIPOLOGIE PRODUTTIVE','','distinct (coalesce ( e.descrizione_attivita , '' '' ) ) || '' ''','elenco_attivita_osm_reg e left join lookup_attivita_osm_reg l on (e.id_attivita = l.code)','org_id = #orgid#','ba1','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','PARTITA IVA','','partita_iva ','organization ','org_id = #orgid#','bab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','CODICE FISCALE   ','','codice_fiscale as codice_fiscale_impresa','organization ','org_id = #orgid#','bac','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','STATO OSM','','coalesce ( lsl.description, '' '' )  || '' '' || 
''in data '' || case when o.date2 is not null then to_char ( o.date2, ''dd/mm/yyyy'')  else '' '' end ','organization o left join lookup_stato_lab lsl on (o.stato_lab = lsl.code) ','o.org_id = #orgid# ','bad','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','CATEGORIA DI RISCHIO','','case when categoria_rischio is null then (''3'') else categoria_rischio end
','organization ','org_id = #orgid#','c','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','INFORMAZIONE PRIMARIA','capitolo','','','','a','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','ASL','asl','asl.description as descr_asl ','lookup_site_id asl left join organization o on o.site_id = asl.code ','o.org_id = #orgid#','ab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','IMPRESA','','name as ragione_sociale ','organization ','org_id = #orgid#','abc','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','NUMERO REGISTRAZIONE','barcode','case when account_number is null or account_number='''' then ''non definito'' else 
case when tipologia = 800 then ''ait''|| account_number else account_number end end as numero_registrazione ','organization ','org_id = #orgid#','B','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','PROSSIMO CONTROLLO CON LA TECNICA DELLA SORVEGLIANZA','','case when prossimo_controllo is null then to_char(current_timestamp, ''dd/mm/yyyy'') else to_char(prossimo_controllo, ''dd/mm/yyyy'') end  as prossimo_controllo ','organization ','org_id = #orgid#','ca','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DATA INIZIO ATTIVITA''','','to_char(date2, ''dd/mm/yyyy'') as data_inizio ','organization ','org_id = #orgid#','cab0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DATA FINE ATTIVITA''','','to_char(date1, ''dd/mm/yyyy'') as data_fine ','organization ','org_id = #orgid#','cab1','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','TITOLARE O LEGALE RAPPRESENTANTE','capitolo','','','','d','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','CODICE FISCALE TITOLARE','','codice_fiscale_rappresentante as codice_fiscale_titolare ','organization ','org_id = #orgid#','d0','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','NOME TITOLARE','','nome_rappresentante as nome_titolare ','organization ','org_id = #orgid#','da','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','COGNOME TITOLARE','','cognome_rappresentante as cognome_titolare ','organization ','org_id = #orgid#','dab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DATA DI NASCITA TITOLARE','','to_char(data_nascita_rappresentante, ''dd/mm/yyyy'') as data_nascita_titolare ','organization ','org_id = #orgid#','e','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','LUOGO DI NASCITA TITOLARE','','luogo_nascita_rappresentante as luogo_nascita_titolare ','organization ','org_id = #orgid#','ea','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','TELEFONO TITOLARE','','telefono_rappresentante as telefono_titolare ','organization ','org_id = #orgid#','eab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','FAX TITOLARE','','fax as fax_titolare ','organization ','org_id = #orgid#','f','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','EMAIL TITOLARE','','email_rappresentante as email_titolare ','organization ','org_id = #orgid#','fa','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','SEDE LEGALE','indirizzo','case when upper(oaleg.addrline1) is not null then upper(oaleg.addrline1) else  '' '' end || ''  ''|| case when upper(oaleg.addrline2) is not null  then upper(oaleg.addrline2) else  '' '' end || ''  ''|| case  when upper(oaleg.city) is not null  then upper(oaleg.city) else  '' '' end || ''  ''||  case when oaleg.postalcode is not null  then oaleg.postalcode else  '' '' end || ''  ''|| case  when upper(oaleg.state) is not null  then upper(oaleg.state) else  '' ''  end as ind_sede_legale ','organization o left join organization_address oaleg on (o.org_id = oaleg.org_id and oaleg.address_type = 1) ','o.org_id = #orgid#','g','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','SEDE OPERATIVA','indirizzo','case when upper(oaope.addrline1) is not null then upper(oaope.addrline1) else  '' '' end || ''  ''|| case when upper(oaope.city) is not null  then upper(oaope.city) else  '' '' end || '' ''|| case when oaope.postalcode is not null  then oaope.postalcode else  '' '' end || ''  ''|| case when oaope.state is not null  then oaope.state else  '' '' end as ind_sede_operativa ','organization o left join organization_address oaope on (o.org_id = oaope.org_id and oaope.address_type = 5) ','o.org_id = #orgid#','ga','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DETTAGLI ADDIZIONALI','capitolo','','','','gab','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','NOTE','','notes ','organization ','org_id = #orgid#','h','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','DIFFIDATO PER ','',' 	lookup_norme.description || '', ''|| CASE WHEN diffida.stato_diffida = ''0'' then ''[DIFFIDA ATTIVA PER I PROSSIMI 5 ANNI]'' WHEN diffida.stato_diffida = ''1'' then '' [DIFFIDA NON PIU'''' ATTIVA IN QUANTO L''''OSA E'''' STATO SANZIONATO PER QUESTA NORMA]'' end ||'', ''|| ''data diffida: ''|| to_char(t.assigned_date,''dd/mm/yyyy'') as assigned_date','ticket t JOIN ticket nonconf ON nonconf.ticketid = t.id_nonconformita AND nonconf.tipologia = 8 JOIN ticket cu ON cu.id_controllo_ufficiale::text = nonconf.id_controllo_ufficiale::text AND cu.tipologia = 3 left join norme_violate_sanzioni diffida on diffida.idticket=t.ticketid left join lookup_norme on lookup_norme.code=diffida.id_norma','t.ticketid > 0 AND t.tipologia = 11 and current_timestamp< (cu.assigned_date + interval ''5 years'') and t.trashed_date is null and cu.trashed_date is null and nonconf.trashed_date is null and t.org_id = #orgid# order by assigned_date DESC ','l','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','LISTA LINEE PRODUTTIVE','capitolo','','','','GAA','');insert into scheda_operatore_metadati(tipo_operatore, label, attributo, sql_campo, sql_origine, sql_condizione, ordine, destinazione) values ('17','ATTIVITA','','norma ||''<br/>''|| macroarea ||''<br/>''|| aggregazione ||''<br/>''||attivita','ricerche_anagrafiche_old_materializzata','riferimento_id = #orgid# and riferimento_id_nome_col = ''org_id''','GAAA','');